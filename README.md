## 计算等差数列的等幂和 a^k + (a+d)^k + (a+2d)^k + ... + (a+md)^k

以3次幂为例介绍计算思路，其他幂次算法相同

`1^3 +2^3+3^3+...+n^3=?`


`y=x^3`的函数图像如下，`1^3 +2^3+3^3+...+n^3`的值就是各个点的y坐标之和

![曲线图](https://github.com/android-notes/1-x-2-x-...-n-x/blob/develop/img1.png?raw=true)

首先需要计算出`y = x^3 `（x = 1,2,3...）的回归直线`f(x)`，等幂和最终会变成计算等差数列和，即`1^3 +2^3+3^3+...+n^3 = f(1) + f(2) + f(3) + ... + f(n)`

回归直线计算公式如下：

![回归直线计算公式](https://github.com/android-notes/1-x-2-x-...-n-x/blob/develop/img2.png?raw=true)

根据如上公式，算得（1,1）、（2,8）这两点的回归直线系数 a=-6 ， b=7

（1,1）、（2,8）、（3,27）点的回归直线系数 a =-14 ， b =13

（1,1）、（2,8）、（3,27）、（4,64）点的回归直线系数 a =-27， b =20.8

（1,1）、（2,8）、（3,27）、（4,64）、（5,125）点的回归直线系数 a =-46.2， b =30.4

（1,1）、（2,8）...... (6,216)点的回归直线系数 a =-72.8， b =41.8

（1,1）、（2,8）...... (7,343)点的回归直线系数 a =-108， b =55

（1,1）、（2,8）...... (8,512)点的回归直线系数 a =-153， b =70

......

我们得到了如下两组值

| x  |   2   |   3  |   4  |   5   |   6   |  7  | 8    |
| ---| ----  | ---- | ---- | ----- | ----- |-----|------|
| a  | -6    | -14  |-27   |-46.2  |-72.8  |-108 |-153  |
| b  | 7     |  13  |20.8  |30.4   |41.8   |55   |70    |
 

如果能用一个函数表示a或b就可以得到`y=x^3(x=1,2,3,4...)`的回归直线`f(x)`，接下来求这两个函数`fa(x)`和`fb(x)`


先来计算b

依次计算b中相邻两数的差，得到如下数据

| x  |   2   |   3  |   4  |   5   |   6   |  7  |
| ---| ----  | ---- | ---- | ----- | ----- |-----|
| b  | 6     |  7.8 |9.6   |11.4   |13.2   |15   |

再次计算上表中相邻两数的差，得到如下数据

| x  |   2   |   3  |   4  |   5   |   6   |  
| ---| ----  | ---- | ---- | ----- | ----- |
| b  | 1.8   |  1.8 |1.8   |1.8    |1.8    |

最终结果全是1.8 , 总共执行了2次依次相减结果就一样了，所以b和x是二次函数关系。

我们设 `fb(x)=a*x^2+b*x+c`，分别带入求得

a=0.9 ，  b= 1.5 ， c=0.4,

所以 `fb(x)=0.9*x^2 + 1.5*x  +  0.4`,

同理算得a对应的函数是 `fa(x)= -0.2 * x^3 -0.7 * x^2 -0.7 * x -0.2`


所以y=x^3 (x=1,2,3,4,5...)的回归直线是

`f(x) = fb(n)  *  x  +  fa(n) `

所以`1^3 +2^3+3^3+...+n^3` 

= `f(1)+f(2)+f(3)+...+f(n)`
        
= `(fb(n)+fa(n))+(fb(n)*2+fa(n))+(fb(n)*3+fa(n))+...+(fb(n)*n+fa(n))`

=`fb(n)*(1+2+3+...+n) + fa(n)*n`
           
=`fb(n)*(  (1+n)*n/2  )+ fa(n)*n`

=`( 0.9*n^2 + 1.5*n + 0.4 ) *( (1+n)*n/2) +( -0.2 * n^3 -0.7 * n^2 -0.7 * n -0.2)  *  n`

 
化简得：

   `0.25*n^4 + 0.5* n^3 + 0.25* n` = `( n * (n+1) / 2)^2`
   
   


### 附

```


begin:1, step:1, power:1
1/2*n^2 + 1/2*n + 0 
check ok, n = 50000

begin:1, step:1, power:2
1/3*n^3 + 1/2*n^2 + 1/6*n + 0 
check ok, n = 50000

begin:1, step:1, power:3
1/4*n^4 + 1/2*n^3 + 1/4*n^2 + 0 
check ok, n = 50000



begin:-1, step:1, power:1
1/2*n^2 + 1/2*n + -1 
check ok, n = 50000

begin:-1, step:1, power:2
1/3*n^3 + 1/2*n^2 + 1/6*n + 1 
check ok, n = 50000

begin:-1, step:1, power:3
1/4*n^4 + 1/2*n^3 + 1/4*n^2 + -1 
check ok, n = 50000



begin:-2, step:1, power:1
1/2*n^2 + 1/2*n + -3 
check ok, n = 50000

begin:-2, step:1, power:2
1/3*n^3 + 1/2*n^2 + 1/6*n + 5 
check ok, n = 50000

begin:-2, step:1, power:3
1/4*n^4 + 1/2*n^3 + 1/4*n^2 + -9 
check ok, n = 50000


begin:1, step:2, power:1
1/4*n^2 + 1/2*n + 1/4 
check ok, n = 49999

begin:1, step:2, power:2
1/6*n^3 + 1/2*n^2 + 1/3*n + 0 
check ok, n = 49999

begin:1, step:2, power:3
1/8*n^4 + 1/2*n^3 + 1/2*n^2 + -1/8 
check ok, n = 49999




begin:1, step:1, power:4
1/5*n^5 + 1/2*n^4 + 1/3*n^3 + -1/30*n + 0 
check ok, n = 50000

begin:1, step:1, power:5
1/6*n^6 + 1/2*n^5 + 5/12*n^4 + -1/12*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:6
1/7*n^7 + 1/2*n^6 + 1/2*n^5 + -1/6*n^3 + 1/42*n + 0 
check ok, n = 50000

begin:1, step:1, power:7
1/8*n^8 + 1/2*n^7 + 7/12*n^6 + -7/24*n^4 + 1/12*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:8
1/9*n^9 + 1/2*n^8 + 2/3*n^7 + -7/15*n^5 + 2/9*n^3 + -1/30*n + 0 
check ok, n = 50000

begin:1, step:1, power:9
1/10*n^10 + 1/2*n^9 + 3/4*n^8 + -7/10*n^6 + 1/2*n^4 + -3/20*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:10
1/11*n^11 + 1/2*n^10 + 5/6*n^9 + -1*n^7 + 1*n^5 + -1/2*n^3 + 5/66*n + 0 
check ok, n = 50000

begin:1, step:1, power:11
1/12*n^12 + 1/2*n^11 + 11/12*n^10 + -11/8*n^8 + 11/6*n^6 + -11/8*n^4 + 5/12*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:12
1/13*n^13 + 1/2*n^12 + 1*n^11 + -11/6*n^9 + 22/7*n^7 + -33/10*n^5 + 5/3*n^3 + -691/2730*n + 0 
check ok, n = 50000

begin:1, step:1, power:13
1/14*n^14 + 1/2*n^13 + 13/12*n^12 + -143/60*n^10 + 143/28*n^8 + -143/20*n^6 + 65/12*n^4 + -691/420*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:14
1/15*n^15 + 1/2*n^14 + 7/6*n^13 + -91/30*n^11 + 143/18*n^9 + -143/10*n^7 + 91/6*n^5 + -691/90*n^3 + 7/6*n + 0 
check ok, n = 50000

begin:1, step:1, power:15
1/16*n^16 + 1/2*n^15 + 5/4*n^14 + -91/24*n^12 + 143/12*n^10 + -429/16*n^8 + 455/12*n^6 + -691/24*n^4 + 35/4*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:16
1/17*n^17 + 1/2*n^16 + 4/3*n^15 + -14/3*n^13 + 52/3*n^11 + -143/3*n^9 + 260/3*n^7 + -1382/15*n^5 + 140/3*n^3 + -3617/510*n + 0 
check ok, n = 50000

begin:1, step:1, power:17
1/18*n^18 + 1/2*n^17 + 17/12*n^16 + -17/3*n^14 + 221/9*n^12 + -2431/30*n^10 + 1105/6*n^8 + -11747/45*n^6 + 595/3*n^4 + -3617/60*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:18
1/19*n^19 + 1/2*n^18 + 3/2*n^17 + -34/5*n^15 + 34*n^13 + -663/5*n^11 + 1105/3*n^9 + -23494/35*n^7 + 714*n^5 + -3617/10*n^3 + 43867/798*n + 0 
check ok, n = 50000

begin:1, step:1, power:19
1/20*n^20 + 1/2*n^19 + 19/12*n^18 + -323/40*n^16 + 323/7*n^14 + -4199/20*n^12 + 4199/6*n^10 + -223193/140*n^8 + 2261*n^6 + -68723/40*n^4 + 43867/84*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:20
1/21*n^21 + 1/2*n^20 + 5/3*n^19 + -19/2*n^17 + 1292/21*n^15 + -323*n^13 + 41990/33*n^11 + -223193/63*n^9 + 6460*n^7 + -68723/10*n^5 + 219335/63*n^3 + -174611/330*n + 0 
check ok, n = 50000

begin:1, step:1, power:21
1/22*n^22 + 1/2*n^21 + 7/4*n^20 + -133/12*n^18 + 323/4*n^16 + -969/2*n^14 + 146965/66*n^12 + -223193/30*n^10 + 33915/2*n^8 + -481061/20*n^6 + 219335/12*n^4 + -1222277/220*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:22
1/23*n^23 + 1/2*n^22 + 11/6*n^21 + -77/6*n^19 + 209/2*n^17 + -3553/5*n^15 + 11305/3*n^13 + -223193/15*n^11 + 124355/3*n^9 + -755953/10*n^7 + 482537/6*n^5 + -1222277/30*n^3 + 854513/138*n + 0 
check ok, n = 50000

begin:1, step:1, power:23
1/24*n^24 + 1/2*n^23 + 23/12*n^22 + -1771/120*n^20 + 4807/36*n^18 + -81719/80*n^16 + 37145/6*n^14 + -5133439/180*n^12 + 572033/6*n^10 + -17386919/80*n^8 + 11098351/36*n^6 + -28112371/120*n^4 + 854513/12*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:24
1/25*n^25 + 1/2*n^24 + 2*n^23 + -253/15*n^21 + 506/3*n^19 + -14421/10*n^17 + 29716/3*n^15 + -10266878/195*n^13 + 208012*n^11 + -17386919/30*n^9 + 22196702/21*n^7 + -28112371/25*n^5 + 1709026/3*n^3 + -236364091/2730*n + 0 
check ok, n = 50000

begin:1, step:1, power:25
1/26*n^26 + 1/2*n^25 + 25/12*n^24 + -115/6*n^22 + 1265/6*n^20 + -24035/12*n^18 + 185725/12*n^16 + -25667195/273*n^14 + 1300075/3*n^12 + -17386919/12*n^10 + 277458775/84*n^8 + -28112371/6*n^6 + 21362825/6*n^4 + -1181820455/1092*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:26
1/27*n^27 + 1/2*n^26 + 13/6*n^25 + -65/3*n^23 + 16445/63*n^21 + -16445/6*n^19 + 142025/6*n^17 + -10266878/63*n^15 + 2600150/3*n^13 + -20548177/6*n^11 + 3606964075/378*n^9 + -52208689/3*n^7 + 55543345/3*n^5 + -1181820455/126*n^3 + 8553103/6*n + 0 
check ok, n = 50000

begin:1, step:1, power:27
1/28*n^28 + 1/2*n^27 + 9/4*n^26 + -195/8*n^24 + 4485/14*n^22 + -29601/8*n^20 + 142025/4*n^18 + -15400317/56*n^16 + 1671525*n^14 + -61644531/8*n^12 + 721392815/28*n^10 + -469878201/8*n^8 + 166630035/2*n^6 + -3545461365/56*n^4 + 76977927/4*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:28
1/29*n^29 + 1/2*n^28 + 7/3*n^27 + -273/10*n^25 + 390*n^23 + -9867/2*n^21 + 52325*n^19 + -905901/2*n^17 + 3120180*n^15 + -33193209/2*n^13 + 65581165*n^11 + -365460823/2*n^9 + 333260070*n^7 + -709092273/2*n^5 + 179615163*n^3 + -23749461029/870*n + 0 
check ok, n = 50000

begin:1, step:1, power:29
1/30*n^30 + 1/2*n^29 + 29/12*n^28 + -609/20*n^26 + 1885/4*n^24 + -26013/4*n^22 + 303485/4*n^20 + -8757043/12*n^18 + 22621305/4*n^16 + -137514723/4*n^14 + 1901853785/12*n^12 + -10598363867/20*n^10 + 4832271015/4*n^8 + -6854558639/4*n^6 + 5208839727/4*n^4 + -23749461029/60*n^2 + 0 
check ok, n = 50000

begin:1, step:1, power:30
1/31*n^31 + 1/2*n^30 + 5/2*n^29 + -203/6*n^27 + 1131/2*n^25 + -16965/2*n^23 + 216775/2*n^21 + -2304485/2*n^19 + 19959975/2*n^17 + -137514723/2*n^15 + 731482225/2*n^13 + -31795091601/22*n^11 + 8053785025/2*n^9 + -102818379585/14*n^7 + 15626519181/2*n^5 + -23749461029/6*n^3 + 8615841276005/14322*n + 0 
check ok, n = 50000



```







